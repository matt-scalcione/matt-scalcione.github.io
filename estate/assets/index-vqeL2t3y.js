${xn}`)}const an=on.data;if(xt==="supabase"){await importPlanToCloud(an),dt(),notifyPlanUpdated(),yt(an.seedVersion),a(null),tt(null),d(null),et(null),at(null),Gt("Plan imported"),Ct(!1),zt(""),Vt(null),e("/tasks");return}const dn=Object.fromEntries(an.profiles.map(xn=>[xn.id,xn]));if(saveEstateProfiles(dn),saveSeedVersion(an.seedVersion),typeof window<"u"){const xn=En=>an.guidance.filter(gn=>gn.estateId===En);for(const En of an.profiles){const gn=xn(En.id);window.localStorage.setItem(`guidance:${En.id}`,JSON.stringify(gn));const Pn=an.seedTasks.filter(In=>In.estateId===En.id).map(In=>{const{estateId:_i,...Bn}=In;return Bn});window.localStorage.setItem(`seedTasks:${En.id}`,JSON.stringify(Pn))}window.localStorage.getItem("estateActiveId")||window.localStorage.setItem("estateActiveId",an.profiles[0].id)}reseedFromPlan(an),notifyPlanUpdated(),dt(),yt(an.seedVersion),a(null),tt(null),d(null),et(null),at(null),Gt("Plan imported"),Ct(!1),zt(""),Vt(null),e("/tasks")}catch(Pr){console.error(Pr);const on=getErrorMessage$1(Pr,"Unable to import plan");Vt(on)}finally{St(!1)}};return jsxRuntimeExports.jsxs("section",{className:"space-y-10",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-3",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold uppercase tracking-widest text-primary-600",children:"Workspace"}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Profile & settings"}),jsxRuntimeExports.jsx("p",{className:"max-w-2xl text-sm text-slate-500",children:"Capture key docket dates to personalize reminders and manage local data for the Estate demo workspace."})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-6 lg:grid-cols-[1.05fr_1fr]",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsx(CloudBanner,{}),jsxRuntimeExports.jsxs("article",{className:"card-surface space-y-5",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Cloud"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Configure Supabase credentials to connect your workspace to the cloud and keep data in sync across devices."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{htmlFor:"cloudUrl",className:"text-sm font-semibold text-slate-700",children:"Supabase URL"}),jsxRuntimeExports.jsx("input",{id:"cloudUrl",type:"url",placeholder:"https://your-project.supabase.co",value:cr,onChange:Ut,className:"w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-sm shadow-sm focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{htmlFor:"cloudAnonKey",className:"text-sm font-semibold text-slate-700",children:"Supabase anon key"}),jsxRuntimeExports.jsx("textarea",{id:"cloudAnonKey",rows:3,placeholder:"eyJhbGciOi...",value:Tr,onChange:_r,className:"w-full rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-800 shadow-inner focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200"})]}),jsxRuntimeExports.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50/70 p-4 text-xs text-slate-600",children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-slate-700",children:cn}),jsxRuntimeExports.jsx("p",{className:"mt-1 leading-relaxed",children:yr?"Safe mode keeps everything local. Enable cloud to recheck your Supabase keys.":Mt?"Supabase authentication is active. Sign out to switch accounts or update your keys.":"Enter your Supabase project URL and anon key, then save to enable cloud sync and Supabase sign-in."})]}),nr?jsxRuntimeExports.jsx("p",{className:"text-sm text-primary-600",children:nr}):null,Rt?jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:Rt}):null,Or?jsxRuntimeExports.jsx("p",{className:"text-sm text-primary-600",children:Or}):null,rn?jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:rn}):null,Zr?jsxRuntimeExports.jsx("p",{className:"text-sm text-primary-600",children:Zr}):null,hn?jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:hn}):null,jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:Yr,disabled:It,className:"rounded-full bg-primary-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:It?"Saving‚Ä¶":"Save"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:$r,className:"rounded-full border border-primary-200 px-5 py-2 text-sm font-semibold text-primary-700 transition hover:border-primary-300 hover:bg-primary-50",children:"Sign in"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Nt,disabled:sr,className:"rounded-full border border-rose-200 px-5 py-2 text-sm font-semibold text-rose-600 transition hover:border-rose-300 hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-70",children:sr?"Signing out‚Ä¶":"Sign out"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:qt,disabled:yr,className:"rounded-full border border-amber-200 px-5 py-2 text-sm font-semibold text-amber-700 transition hover:border-amber-300 hover:bg-amber-50 disabled:cursor-not-allowed disabled:opacity-70",children:"Disable Cloud (Safe Mode)"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:pr,disabled:!yr,className:"rounded-full border border-emerald-200 px-5 py-2 text-sm font-semibold text-emerald-700 transition hover:border-emerald-300 hover:bg-emerald-50 disabled:cursor-not-allowed disabled:opacity-70",children:"Enable Cloud"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:gr,className:"rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-700 transition hover:border-slate-300 hover:bg-slate-50",children:"Clear Cloud Keys"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Dr,disabled:Sr||xt!=="supabase"||!Ot,className:"rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-700 transition hover:border-primary-300 hover:bg-primary-50 disabled:cursor-not-allowed disabled:opacity-70",children:Sr?"Migrating‚Ä¶":"Migrate local data now"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:qr,disabled:un||xt!=="supabase"||!Ot,className:"rounded-full border border-slate-200 px-5 py-2 text-sm font-semibold text-slate-700 transition hover:border-primary-300 hover:bg-primary-50 disabled:cursor-not-allowed disabled:opacity-70",children:un?"Migrating‚Ä¶":"Migrate local documents to cloud"})]})]})]}),jsxRuntimeExports.jsxs("article",{className:"card-surface space-y-5",children:[jsxRuntimeExports.jsxs("header",{className:"flex flex-wrap items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Estate plans"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Switch between estates to view tailored tasks, documents, and guidance."})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Vr,className:"rounded-full border border-primary-200 bg-white px-4 py-2 text-sm font-semibold text-primary-700 transition hover:border-primary-300 hover:bg-primary-50",children:"Import plan"})]}),jsxRuntimeExports.jsx("div",{className:"grid gap-3 sm:grid-cols-2",children:ESTATE_IDS.map(Pr=>{const on=vt[Pr],an=Pr===gt;return jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>At(Pr),"aria-pressed":an,className:`rounded-2xl border px-4 py-4 text-left transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-400 ${an?"border-primary-400 bg-primary-50 shadow-sm shadow-primary-100":"border-slate-200 bg-white hover:border-primary-200 hover:bg-primary-50/70"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold text-slate-700",children:on.label}),an?jsxRuntimeExports.jsx("span",{className:"rounded-full bg-primary-500 px-2 py-0.5 text-xs font-semibold text-white",children:"Active"}):null]}),jsxRuntimeExports.jsxs("dl",{className:"mt-3 space-y-1 text-xs text-slate-600",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between gap-2",children:[jsxRuntimeExports.jsx("dt",{className:"font-medium text-slate-500",children:"Decedent"}),jsxRuntimeExports.jsx("dd",{className:"text-right text-slate-700",children:on.decedentName||"Not set"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between gap-2",children:[jsxRuntimeExports.jsx("dt",{className:"font-medium text-slate-500",children:"County"}),jsxRuntimeExports.jsx("dd",{className:"text-right text-slate-700",children:on.county?`${on.county} County`:"Not set"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between gap-2",children:[jsxRuntimeExports.jsx("dt",{className:"font-medium text-slate-500",children:"Date of death"}),jsxRuntimeExports.jsx("dd",{className:"text-right text-slate-700",children:formatPlanDate(on.dodISO)})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between gap-2",children:[jsxRuntimeExports.jsx("dt",{className:"font-medium text-slate-500",children:"Letters"}),jsxRuntimeExports.jsx("dd",{className:"text-right text-slate-700",children:formatPlanDate(on.lettersISO)})]})]})]},Pr)})}),Tt?jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500",children:["Last imported seed version"," ",jsxRuntimeExports.jsx("span",{className:"font-semibold text-slate-700",children:Tt})]}):null]}),jsxRuntimeExports.jsxs("article",{className:"card-surface space-y-6",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Estate timeline"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Enter milestone dates to unlock recommended reminders and populate the checklist with suggested tasks."})]}),jsxRuntimeExports.jsxs("form",{className:"space-y-6",onSubmit:kr,children:[jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{htmlFor:"dateOfDeath",className:"text-sm font-semibold text-slate-700",children:"Date of death"}),jsxRuntimeExports.jsx("input",{id:"dateOfDeath",name:"dateOfDeath",type:"date",required:!0,value:s.dateOfDeath,onChange:Cr,className:"w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-sm shadow-sm transition focus:border-primary-400"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{htmlFor:"lettersGranted",className:"text-sm font-semibold text-slate-700",children:"Letters granted"}),jsxRuntimeExports.jsx("input",{id:"lettersGranted",name:"lettersGranted",type:"date",required:!0,value:s.lettersGranted,onChange:Cr,className:"w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-sm shadow-sm transition focus:border-primary-400"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("label",{htmlFor:"firstPublication",className:"text-sm font-semibold text-slate-700",children:"First publication (optional)"}),jsxRuntimeExports.jsx("input",{id:"firstPublication",name:"firstPublication",type:"date",value:s.firstPublication,onChange:Cr,className:"w-full rounded-2xl border border-slate-200 px-4 py-2.5 text-sm shadow-sm transition focus:border-primary-400"})]}),jsxRuntimeExports.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white/70 p-4",children:jsxRuntimeExports.jsxs("label",{htmlFor:"estate1041Required",className:"flex items-start gap-3 text-sm text-slate-700",children:[jsxRuntimeExports.jsx("input",{id:"estate1041Required",name:"estate1041Required",type:"checkbox",checked:s.estate1041Required,onChange:Cr,className:"mt-1 h-4 w-4 rounded border-slate-300 text-primary-600"}),jsxRuntimeExports.jsxs("span",{children:["Estate expects to file Form 1041",jsxRuntimeExports.jsx("span",{className:"mt-1 block text-xs text-slate-500",children:"Uncheck if the estate has no fiduciary income tax filing obligation."})]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[jsxRuntimeExports.jsx("button",{type:"submit",disabled:g,className:"rounded-full bg-primary-600 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:g?"Saving‚Ä¶":"Save setup"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Gr,disabled:_,className:"rounded-full border border-primary-200 bg-primary-50 px-5 py-2.5 text-sm font-semibold text-primary-700 transition hover:border-primary-300 hover:text-primary-800 disabled:cursor-not-allowed disabled:opacity-70",children:_?"Creating‚Ä¶":"Generate default checklist"})]}),o&&jsxRuntimeExports.jsx("p",{className:"text-sm text-emerald-600",children:o}),_e&&jsxRuntimeExports.jsx("p",{className:"text-sm text-primary-700",children:_e}),c&&jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:c})]})]}),jsxRuntimeExports.jsxs("article",{className:"card-surface space-y-6",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Workspace data"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Export your tasks, document metadata and files, journal entries, and estate profile‚Äîor restore the built-in demo content."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("p",{className:"rounded-2xl bg-slate-50/80 p-4 text-sm text-slate-600",children:"Exports are saved as a JSON file that you can re-import later. Imports replace the data currently stored on this device."}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:zr,disabled:nt,className:"rounded-full bg-primary-600 px-5 py-2.5 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:nt?"Preparing export‚Ä¶":"Export workspace"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Fr,disabled:lt,className:"rounded-full border border-primary-200 bg-white px-5 py-2.5 text-sm font-semibold text-primary-700 transition hover:border-primary-300 hover:bg-primary-50 disabled:cursor-not-allowed disabled:opacity-70",children:lt?"Importing‚Ä¶":"Import from file"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Kr,disabled:ot,className:"rounded-full border border-slate-300 bg-slate-50 px-5 py-2.5 text-sm font-semibold text-slate-700 transition hover:bg-slate-100 disabled:cursor-not-allowed disabled:opacity-70",children:ot?"Restoring‚Ä¶":"Reset demo data"})]}),rt&&jsxRuntimeExports.jsx("p",{className:"text-sm text-emerald-600",children:rt}),ut&&jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:ut})]}),jsxRuntimeExports.jsx("input",{ref:ht,type:"file",accept:"application/json",className:"hidden",onChange:nn})]})]}),jsxRuntimeExports.jsxs("article",{className:"card-surface space-y-6",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Suggested due dates"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Deadlines adjust automatically based on the dates provided. Generate the checklist to add them as tasks with workstream tags."})]}),Lr.length===0?jsxRuntimeExports.jsx("p",{className:"rounded-2xl border border-dashed border-slate-200 bg-slate-50/80 p-5 text-sm text-slate-500",children:"Add the date of death and letters granted to preview recommended deadlines."}):jsxRuntimeExports.jsx("ul",{className:"space-y-4",children:Lr.map(Pr=>jsxRuntimeExports.jsxs("li",{className:"rounded-2xl border border-slate-200 p-4 text-sm shadow-sm transition hover:border-primary-200/70",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-semibold text-slate-900",children:Pr.title}),jsxRuntimeExports.jsx("p",{className:"text-xs uppercase tracking-wide text-primary-600",children:Pr.tag})]}),jsxRuntimeExports.jsx("span",{className:`rounded-full px-3 py-1 text-xs font-semibold ${Pr.dueDate?"bg-primary-100 text-primary-700":"bg-slate-100 text-slate-500"}`,children:formatDeadlineDate(Pr.dueDate)})]}),Pr.description&&jsxRuntimeExports.jsx("p",{className:"mt-3 text-xs leading-relaxed text-slate-500",children:Pr.description}),Pr.optional&&!Pr.dueDate&&jsxRuntimeExports.jsx("p",{className:"mt-3 text-xs font-medium text-amber-600",children:"Marked as not applicable."})]},Pr.key))})]})]}),wt?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-slate-900/60 px-4 py-6",children:jsxRuntimeExports.jsxs("div",{className:"w-full max-w-xl rounded-2xl bg-white p-6 shadow-xl",children:[jsxRuntimeExports.jsxs("header",{className:"mb-4 space-y-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Import estate plan"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Paste the JSON configuration to load profiles, seeded tasks, documents, and guidance into this device."})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("button",{type:"button",className:"text-xs font-semibold text-primary-600 transition hover:text-primary-700",onClick:()=>{zt(SAMPLE_PLAN),Vt(null)},disabled:$t,children:"Show sample JSON"})}),jsxRuntimeExports.jsx("textarea",{value:Kt,onChange:Pr=>{zt(Pr.target.value),Vt(null)},rows:10,className:"w-full rounded-2xl border border-slate-200 px-4 py-3 text-sm text-slate-800 shadow-inner focus:border-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-200",placeholder:'{"seedVersion":"v2","estateProfiles":{...}}'}),Xt?jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:Xt}):null,jsxRuntimeExports.jsxs("div",{className:"flex justify-end gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:en,className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-semibold text-slate-600 transition hover:border-slate-300 hover:bg-slate-100",disabled:$t,children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:sn,disabled:$t,className:"rounded-full bg-primary-600 px-5 py-2 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:$t?"Importing‚Ä¶":"Import"})]})]})]})}):null,Ft?jsxRuntimeExports.jsx("div",{className:"fixed bottom-24 left-1/2 z-30 -translate-x-1/2 rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white shadow-lg",children:Ft}):null]})},priorityStyles={low:"bg-emerald-100 text-emerald-700",med:"bg-amber-100 text-amber-700",high:"bg-rose-100 text-rose-700"},statusLabels={"not-started":"Not started","in-progress":"In progress",done:"Completed"},startOfToday=()=>{const e=new Date;return e.setHours(0,0,0,0),e},addDays=(e,s)=>{const i=new Date(e);return i.setDate(i.getDate()+s),i},toLocalDateInput=e=>{if(!e)return"";const s=new Date(e),i=s.getFullYear(),o=`${s.getMonth()+1}`.padStart(2,"0"),a=`${s.getDate()}`.padStart(2,"0");return`${i}-${o}-${a}`},parseList=e=>e.split(",").map(s=>s.trim()).filter(Boolean),formatDueDate=e=>e?new Date(e).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"}):"No due date",formatBytes=e=>{if(!e)return"0 B";const s=["B","KB","MB","GB"],i=Math.min(Math.floor(Math.log(e)/Math.log(1024)),s.length-1),o=e/1024**i;return`${i===0?o.toFixed(0):o.toFixed(1)} ${s[i]}`},getErrorMessage=(e,s)=>e instanceof Error&&e.message?e.message:s,enhanceFallbackMessage=e=>e.includes("Saved locally")?e:`${e}. Saved locally; will sync once cloud access is restored.`,resolveCloudFallbackMessage=(e,s)=>enhanceFallbackMessage(getErrorMessage(e,s)),toDateOnly=e=>{if(!e)return null;const s=new Date(e);return Number.isNaN(s.valueOf())?null:s.toISOString().split("T")[0]},emptyFormState={title:"",description:"",due_date:"",status:"not-started",priority:"med",tags:""},createFormState=e=>e?{title:e.title,description:e.description,due_date:toLocalDateInput(e.due_date),status:e.status,priority:e.priority,tags:e.tags.join(", ")}:{...emptyFormState},Tasks=()=>{const[e,s]=reactExports.useState([]),[i,o]=reactExports.useState(!0),[a,c]=reactExports.useState(null),[d,g]=reactExports.useState(!1),[h,_]=reactExports.useState("all"),[j,_e]=reactExports.useState(!1),[tt,rt]=reactExports.useState({...emptyFormState}),[et,ut]=reactExports.useState(!1),[at,nt]=reactExports.useState([]),[st,lt]=reactExports.useState(""),[mt,ot]=reactExports.useState(!1),[ft,ht]=reactExports.useState(null),[gt,vt]=reactExports.useState([]),[At,dt]=reactExports.useState([]),wt=useNavigate(),Ct=useLocation(),{taskId:Kt}=useParams(),{activeEstateId:zt}=useEstate(),{mode:Xt,isAuthenticated:Vt}=useAuth(),$t=e.find(It=>It.id===Kt)||null,St=reactExports.useCallback(()=>{vt(loadSeedTasks(zt)),dt(normalizeGuidanceEntries(loadSeedGuidance(zt)))},[zt]);reactExports.useEffect(()=>{St();const It=sr=>{if(!sr.key){St();return}(sr.key==="seedVersion"||sr.key.startsWith("seedTasks:")||sr.key.startsWith("tasks:")||sr.key.startsWith("guidance:"))&&St()},Bt=()=>{St()};return window.addEventListener("storage",It),window.addEventListener(ESTATE_PLAN_UPDATED_EVENT,Bt),()=>{window.removeEventListener("storage",It),window.removeEventListener(ESTATE_PLAN_UPDATED_EVENT,Bt)}},[St]),reactExports.useEffect(()=>{let It=!0;(async()=>{try{Xt==="supabase"&&Vt?await Promise.all([syncTasksFromCloud(zt),syncSeedTasksFromCloud(zt),syncGuidanceFromCloud(zt),syncDocumentsFromCloud(zt)]):await seedTasksIfEmpty()}catch(br){if(console.error(br),!It)return;c(getErrorMessage(br,"Unable to load tasks")),o(!1)}})();const sr=liveQuery(()=>db.tasks.where("estateId").equals(zt).toArray()).subscribe({next:br=>{if(!It)return;const Sr=[...br].sort((Yt,Or)=>new Date(Yt.due_date).getTime()-new Date(Or.due_date).getTime());s(Sr),o(!1)},error:br=>{console.error(br),It&&(c(getErrorMessage(br,"Unable to load tasks")),o(!1))}});return()=>{It=!1,sr.unsubscribe()}},[zt,Xt,Vt]),reactExports.useEffect(()=>{let It=!0;const Bt=liveQuery(()=>db.documents.where("estateId").equals(zt).toArray()).subscribe({next:sr=>{if(!It)return;const br=[...sr].sort((Sr,Yt)=>new Date(Yt.created_at).getTime()-new Date(Sr.created_at).getTime());nt(br)},error:sr=>{console.error(sr),It&&c(getErrorMessage(sr,"Unable to load documents"))}});return()=>{It=!1,Bt.unsubscribe()}},[zt]),reactExports.useEffect(()=>{!Kt||e.some(It=>It.id===Kt)||wt("/tasks",{replace:!0})},[Kt,e,wt]),reactExports.useEffect(()=>{const It=Ct.state;It!=null&&It.startCreate&&(c(null),rt({...emptyFormState}),_e(!0),wt(Ct.pathname+Ct.search,{replace:!0}))},[Ct,wt]);const Ft=reactExports.useMemo(()=>{const It=new Set;return e.forEach(Bt=>Bt.tags.forEach(sr=>It.add(sr))),Array.from(It).sort((Bt,sr)=>Bt.localeCompare(sr))},[e]),Gt=reactExports.useMemo(()=>e.filter(It=>!(!d&&It.status==="done"||h!=="all"&&!It.tags.includes(h))),[e,d,h]),Tt=reactExports.useMemo(()=>{if(!$t)return[];const It=new Set($t.docIds);return at.filter(Bt=>Bt.taskId===$t.id||It.has(Bt.id))},[at,$t]),yt=reactExports.useMemo(()=>{const It=new Map;return At.forEach(Bt=>{It.set(Bt.id,Bt)}),It},[At]),xt=reactExports.useMemo(()=>{if(!$t)return null;const It=$t.title.trim().toLowerCase(),Bt=gt.filter(br=>br.title.trim().toLowerCase()===It);if(Bt.length===0)return null;const sr=toDateOnly($t.due_date);if(sr){const br=Bt.find(Sr=>toDateOnly(Sr.dueISO)===sr);if(br)return br}return Bt[0]},[$t,gt]),_t=reactExports.useMemo(()=>xt!=null&&xt.linkTo?xt.linkTo.filter(It=>It.type==="guide").map(It=>{const Bt=yt.get(It.value);return Bt?{id:It.value,title:Bt.title,summary:Bt.summary??Bt.notes[0],anchor:Bt.anchor??guidanceAnchorForId(Bt.id)}:{id:It.value,title:It.value,summary:void 0,anchor:guidanceAnchorForId(It.value)}}):[],[xt,yt]),kt=reactExports.useMemo(()=>at.filter(It=>!It.taskId),[at]),jt=It=>{wt(`/tasks/${It}`)},Ot=It=>{const{name:Bt,value:sr}=It.target;rt(br=>({...br,[Bt]:sr}))},Mt=()=>{rt({...emptyFormState}),ut(!1)},ir=async It=>{if(It.preventDefault(),!tt.title||!tt.due_date){c("Title and due date are required");return}c(null),ut(!0);try{const Bt=await createTask({estateId:zt,title:tt.title,description:tt.description,due_date:tt.due_date,status:tt.status,priority:tt.priority,tags:parseList(tt.tags)});Mt(),_e(!1),c(null),wt(`/tasks/${Bt}`)}catch(Bt){if(console.error(Bt),isCloudFallbackError(Bt)){const sr=Bt.localId??null;Mt(),_e(!1),c(resolveCloudFallbackMessage(Bt,"Unable to save task")),sr&&wt(`/tasks/${sr}`)}else c(getErrorMessage(Bt,"Unable to save task"));ut(!1)}},yr=async It=>{if(It.preventDefault(),!!$t){if(!tt.title||!tt.due_date){c("Title and due date are required");return}c(null),ut(!0);try{await updateTask($t.id,{title:tt.title,description:tt.description,due_date:tt.due_date,status:tt.status,priority:tt.priority,tags:parseList(tt.tags)}),c(null),ut(!1)}catch(Bt){console.error(Bt);const sr=isCloudFallbackError(Bt)?resolveCloudFallbackMessage(Bt,"Unable to update task"):getErrorMessage(Bt,"Unable to update task");c(sr),ut(!1)}}},cr=async It=>{c(null);try{await deleteTask(It),Kt===It&&wt("/tasks"),c(null)}catch(Bt){console.error(Bt);const sr=isCloudFallbackError(Bt)?resolveCloudFallbackMessage(Bt,"Unable to delete task"):getErrorMessage(Bt,"Unable to delete task");c(sr)}},Er=async It=>{c(null);try{await updateTask(It.id,{status:"done"})}catch(Bt){console.error(Bt);const sr=isCloudFallbackError(Bt)?resolveCloudFallbackMessage(Bt,"Unable to update task status"):getErrorMessage(Bt,"Unable to update task status");c(sr)}},Tr=async It=>{if(It.preventDefault(),!(!$t||!st)){c(null),ot(!0);try{await linkDocumentToTask(st,$t.id),lt("")}catch(Bt){console.error(Bt);const sr=isCloudFallbackError(Bt)?resolveCloudFallbackMessage(Bt,"Unable to link document"):getErrorMessage(Bt,"Unable to link document");c(sr)}finally{ot(!1)}}},Rr=async It=>{c(null),ht(It);try{await unlinkDocumentFromTask(It)}catch(Bt){console.error(Bt);const sr=isCloudFallbackError(Bt)?resolveCloudFallbackMessage(Bt,"Unable to unlink document"):getErrorMessage(Bt,"Unable to unlink document");c(sr)}finally{ht(null)}},nr=()=>{Mt(),_e(!0),wt("/tasks")},rr=()=>{$t&&(rt(createFormState($t)),_e(!1))};reactExports.useEffect(()=>{rt($t?createFormState($t):{...emptyFormState}),lt("")},[$t]);const Rt=reactExports.useMemo(()=>startOfToday(),[]),Dt=reactExports.useMemo(()=>addDays(Rt,7),[Rt]);return jsxRuntimeExports.jsxs("section",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Tasks"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Track outstanding deliverables, collaborate with your team, and keep estate planning work moving."})]}),jsxRuntimeExports.jsx(CloudBanner,{}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col gap-6 lg:flex-row",children:[jsxRuntimeExports.jsxs("div",{className:"lg:w-1/2",children:[jsxRuntimeExports.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-3",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:nr,className:"rounded-full bg-primary-600 px-4 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-primary-500",children:"New Task"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>g(It=>!It),className:`rounded-full border px-4 py-2 text-sm font-medium transition ${d?"border-primary-200 bg-primary-50 text-primary-700":"border-slate-200 text-slate-600 hover:border-primary-200 hover:text-primary-600"}`,children:d?"Hide Completed":"Show Completed"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-600",children:[jsxRuntimeExports.jsx("label",{htmlFor:"tag-filter",className:"font-medium",children:"Tag"}),jsxRuntimeExports.jsxs("select",{id:"tag-filter",value:h,onChange:It=>_(It.target.value),className:"rounded-full border border-slate-200 bg-white px-3 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none",children:[jsxRuntimeExports.jsx("option",{value:"all",children:"All"}),Ft.map(It=>jsxRuntimeExports.jsx("option",{value:It,children:It},It))]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[i&&jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Loading tasks‚Ä¶"}),a&&!i&&jsxRuntimeExports.jsx("p",{className:"text-sm text-rose-600",children:a}),!i&&Gt.length===0&&jsxRuntimeExports.jsx("p",{className:"rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-6 text-sm text-slate-500",children:"No tasks match the selected filters yet."}),Gt.map(It=>{const Bt=new Date(It.due_date),sr=It.status!=="done"&&Bt<Rt,br=!sr&&It.status!=="done"&&Bt<=Dt;return jsxRuntimeExports.jsx("article",{className:`rounded-2xl border p-5 shadow-sm transition hover:border-primary-200 hover:shadow-md ${Kt===It.id?"border-primary-300 bg-primary-50/40":"border-slate-200 bg-white"}`,children:jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>jt(It.id),className:"flex w-full flex-col gap-3 text-left",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:It.title}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:statusLabels[It.status]})]}),jsxRuntimeExports.jsxs("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${priorityStyles[It.priority]}`,children:[It.priority==="med"?"Medium":It.priority==="low"?"Low":"High"," priority"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs font-medium",children:[jsxRuntimeExports.jsxs("span",{className:`rounded-full px-3 py-1 ${sr?"bg-rose-100 text-rose-700":br?"bg-amber-100 text-amber-700":"bg-slate-100 text-slate-600"}`,children:["Due ",formatDueDate(It.due_date)]}),It.tags.map(Sr=>jsxRuntimeExports.jsxs("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:["#",Sr]},Sr))]})]})},It.id)})]})]}),jsxRuntimeExports.jsx("div",{className:"lg:w-1/2",children:jsxRuntimeExports.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:j?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-1",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Create task"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-500",children:"Add a new deliverable to your estate planning pipeline."})]}),jsxRuntimeExports.jsxs("form",{className:"space-y-4",onSubmit:ir,children:[jsxRuntimeExports.jsx(TaskFormFields,{formState:tt,submitting:et,onChange:Ot}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[jsxRuntimeExports.jsx("button",{type:"submit",disabled:et,className:"rounded-full bg-primary-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:et?"Saving‚Ä¶":"Save task"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>{Mt(),_e(!1)},className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-primary-200 hover:text-primary-600",children:"Cancel"})]})]})]}):$t?jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("header",{className:"space-y-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:$t.title}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-slate-500",children:["Due ",formatDueDate($t.due_date)]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>cr($t.id),className:"text-sm font-medium text-rose-600 transition hover:text-rose-500",children:"Delete"})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-medium",children:[jsxRuntimeExports.jsxs("span",{className:`rounded-full px-3 py-1 ${priorityStyles[$t.priority]}`,children:[$t.priority==="med"?"Medium":$t.priority==="low"?"Low":"High"," ","priority"]}),jsxRuntimeExports.jsx("span",{className:"rounded-full bg-slate-100 px-3 py-1 text-slate-600",children:statusLabels[$t.status]})]})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-600",children:$t.description||"No description provided yet."}),$t.tags.length>0&&jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 text-xs font-medium text-slate-500",children:$t.tags.map(It=>jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{_(It),wt("/tasks")},className:`rounded-full border px-3 py-1 transition hover:border-primary-200 hover:text-primary-600 ${h===It?"border-primary-300 bg-primary-50 text-primary-700":"border-slate-200"}`,children:["#",It]},It))}),_t.length>0?jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Guidance"}),jsxRuntimeExports.jsx("ul",{className:"space-y-2",children:_t.map(It=>jsxRuntimeExports.jsx("li",{children:jsxRuntimeExports.jsxs(Link,{to:`/guidance#${It.anchor}`,className:"flex items-center justify-between rounded-2xl border border-primary-200 bg-primary-50 px-4 py-3 text-sm font-semibold text-primary-700 transition hover:border-primary-300 hover:bg-primary-100",children:[jsxRuntimeExports.jsxs("span",{className:"flex-1 text-left",children:[It.title,It.summary?jsxRuntimeExports.jsx("span",{className:"mt-1 block text-xs font-normal text-primary-600/90",children:It.summary}):null]}),jsxRuntimeExports.jsx("span",{"aria-hidden":!0,className:"ml-3 text-base",children:"‚Üí"})]})},It.id))})]}):null,Tt.length>0&&jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Linked documents"}),jsxRuntimeExports.jsx("ul",{className:"space-y-2",children:Tt.map(It=>jsxRuntimeExports.jsxs("li",{className:"flex items-center justify-between gap-3 rounded-xl border border-slate-200 px-3 py-2",children:[jsxRuntimeExports.jsxs("div",{className:"min-w-0",children:[jsxRuntimeExports.jsx(Link,{to:`/documents?highlight=${encodeURIComponent(It.id)}`,className:"block truncate text-sm font-medium text-primary-600 hover:underline",children:It.title||"Untitled document"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-slate-500",children:[It.contentType.includes("pdf")?"PDF":It.contentType.startsWith("image/")?"Image":It.contentType.includes("text")?"Text":"Document"," ","‚Ä¢ ",formatBytes(It.size)]})]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Rr(It.id),disabled:ft===It.id,className:"text-xs font-medium text-rose-600 transition hover:text-rose-500 disabled:cursor-not-allowed disabled:opacity-60",children:ft===It.id?"Unlinking‚Ä¶":"Unlink"})]},It.id))})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-semibold text-slate-700",children:"Link a document"}),kt.length>0?jsxRuntimeExports.jsxs("form",{className:"flex flex-wrap items-center gap-2",onSubmit:Tr,children:[jsxRuntimeExports.jsxs("select",{value:st,onChange:It=>lt(It.target.value),disabled:mt,className:"min-w-[200px] flex-1 rounded-xl border border-slate-200 px-3 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select document"}),kt.map(It=>jsxRuntimeExports.jsxs("option",{value:It.id,children:[It.title||"Untitled document"," (",formatBytes(It.size),")"]},It.id))]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:!st||mt,className:"rounded-full bg-primary-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:mt?"Linking‚Ä¶":"Link"})]}):jsxRuntimeExports.jsx("p",{className:"text-xs text-slate-500",children:"All documents are currently linked. Manage files from the Documents page."})]}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[$t.status!=="done"&&jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Er($t),className:"rounded-full bg-emerald-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-emerald-500",children:"Mark Done"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:rr,className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-primary-200 hover:text-primary-600",children:"Edit"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>wt("/tasks"),className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-primary-200 hover:text-primary-600",children:"Close"})]}),jsxRuntimeExports.jsxs("form",{className:"space-y-4",onSubmit:yr,children:[jsxRuntimeExports.jsx(TaskFormFields,{formState:tt,submitting:et,onChange:Ot}),jsxRuntimeExports.jsxs("div",{className:"flex flex-wrap gap-3",children:[jsxRuntimeExports.jsx("button",{type:"submit",disabled:et,className:"rounded-full bg-primary-600 px-4 py-2 text-sm font-semibold text-white transition hover:bg-primary-500 disabled:cursor-not-allowed disabled:opacity-70",children:et?"Saving‚Ä¶":"Save changes"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>rt(createFormState($t)),className:"rounded-full border border-slate-200 px-4 py-2 text-sm font-medium text-slate-600 transition hover:border-primary-200 hover:text-primary-600",children:"Reset"})]})]})]}):jsxRuntimeExports.jsxs("div",{className:"space-y-4 text-sm text-slate-500",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Select a task"}),jsxRuntimeExports.jsx("p",{children:"Choose a task from the list to view its details, update progress, or link related documents. Create a new task to capture upcoming work for your estate plan."})]})})})]})]})},TaskFormFields=({formState:e,submitting:s,onChange:i})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("label",{htmlFor:"title",className:"text-sm font-medium text-slate-700",children:"Title"}),jsxRuntimeExports.jsx("input",{id:"title",name:"title",required:!0,value:e.title,disabled:s,onChange:i,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("label",{htmlFor:"description",className:"text-sm font-medium text-slate-700",children:"Description"}),jsxRuntimeExports.jsx("textarea",{id:"description",name:"description",rows:4,value:e.description,disabled:s,onChange:i,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none"})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("label",{htmlFor:"due_date",className:"text-sm font-medium text-slate-700",children:"Due date"}),jsxRuntimeExports.jsx("input",{id:"due_date",name:"due_date",type:"date",required:!0,value:e.due_date,disabled:s,onChange:i,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("label",{htmlFor:"status",className:"text-sm font-medium text-slate-700",children:"Status"}),jsxRuntimeExports.jsxs("select",{id:"status",name:"status",value:e.status,disabled:s,onChange:i,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none",children:[jsxRuntimeExports.jsx("option",{value:"not-started",children:"Not started"}),jsxRuntimeExports.jsx("option",{value:"in-progress",children:"In progress"}),jsxRuntimeExports.jsx("option",{value:"done",children:"Done"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("label",{htmlFor:"priority",className:"text-sm font-medium text-slate-700",children:"Priority"}),jsxRuntimeExports.jsxs("select",{id:"priority",name:"priority",value:e.priority,disabled:s,onChange:i,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none",children:[jsxRuntimeExports.jsx("option",{value:"low",children:"Low"}),jsxRuntimeExports.jsx("option",{value:"med",children:"Medium"}),jsxRuntimeExports.jsx("option",{value:"high",children:"High"})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx("label",{htmlFor:"tags",className:"text-sm font-medium text-slate-700",children:"Tags (comma separated)"}),jsxRuntimeExports.jsx("input",{id:"tags",name:"tags",value:e.tags,disabled:s,onChange:i,className:"w-full rounded-xl border border-slate-200 px-4 py-2 text-sm shadow-sm focus:border-primary-400 focus:outline-none"})]})]})]}),Setup=()=>jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-semibold",children:"Setup"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-slate-600",children:"Configuration tools and onboarding steps will appear here."})]}),ROUTES=[{path:"/dashboard",label:"Dashboard",icon:"home",primary:!0},{path:"/tasks",label:"Tasks",icon:"check",primary:!0},{path:"/guidance",label:"Guidance",icon:"book",primary:!0},{path:"/documents",label:"Documents",icon:"file",primary:!0},{path:"/calendar",label:"Calendar",icon:"calendar"},{path:"/journal",label:"Journal",icon:"note"},{path:"/buyout",label:"Buyout",icon:"dollar"},{path:"/profile",label:"Profile",icon:"user"},{path:"/setup",label:"Setup",icon:"settings"}],ICONS$1={home:House,check:SquareCheckBig,book:BookOpen,file:FileText,calendar:Calendar$1,note:NotebookPen,folder:Folder,user:User,settings:Settings,dollar:DollarSign},FlyoutMenu=({open:e,onClose:s,overdueCount:i,onLogout:o})=>{const a=useNavigate(),c=useLocation(),d=reactExports.useRef(null);if(reactExports.useEffect(()=>{if(e){const _=document.activeElement;document.body.style.setProperty("overflow","hidden");const j=window.setTimeout(()=>{var _e;(_e=d.current)==null||_e.focus({preventScroll:!0})},0);return()=>{var _e;window.clearTimeout(j),document.body.style.removeProperty("overflow"),(_e=_==null?void 0:_.focus)==null||_e.call(_)}}},[e]),reactExports.useEffect(()=>{if(!e)return;const _=j=>{j.key==="Escape"&&(j.preventDefault(),s())};return window.addEventListener("keydown",_),()=>{window.removeEventListener("keydown",_)}},[e,s]),!e)return null;const g=_=>{s(),a(_)},h=_=>{_.target===_.currentTarget&&s()};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50",role:"dialog","aria-modal":"true",children:jsxRuntimeExports.jsx("div",{className:"flyout-backdrop",onClick:h,children:jsxRuntimeExports.jsxs("div",{className:"flyout-panel shadow-xl",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.18em] text-primary-500",children:"Navigation"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-slate-900",children:"Quick access"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center gap-2",children:jsxRuntimeExports.jsx("button",{type:"button","aria-label":"Close menu",ref:d,onClick:s,className:"rounded-full border border-slate-200 p-2 text-slate-600 transition-colors hover:border-slate-300 hover:text-slate-900",children:jsxRuntimeExports.jsx(X,{size:18})})})]}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-1 gap-2",children:ROUTES.map(_=>{const j=ICONS$1[_.icon],_e=c.pathname.startsWith(_.path);return jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>g(_.path),className:`flex items-center justify-between rounded-2xl border border-transparent px-4 py-3 text-left transition-colors focus-visible:ring-offset-0 ${_e?"bg-primary-50 text-primary-700":"hover:border-slate-200 hover:bg-slate-50"}`,children:[jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-3 text-sm font-semibold",children:[jsxRuntimeExports.jsx(j,{size:18,className:"text-primary-500"}),jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[_.label,_.path==="/tasks"&&i>0?jsxRuntimeExports.jsx("span",{className:"inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-rose-500 px-1.5 text-xs font-semibold text-white",children:i}):null]})]}),jsxRuntimeExports.jsx(Ellipsis,{size:18,className:"text-slate-400"})]},_.path)})}),jsxRuntimeExports.jsx("div",{className:"mt-6 border-t border-slate-200 pt-4",children:jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{s(),o()},className:"flex w-full items-center justify-between rounded-2xl border border-transparent px-4 py-3 text-sm font-semibold text-slate-700 transition-colors hover:border-rose-200 hover:bg-rose-50 hover:text-rose-600 focus-visible:ring-offset-0",children:[jsxRuntimeExports.jsx("span",{children:"Logout"}),jsxRuntimeExports.jsx(X,{size:16,className:"rotate-45"})]})})]})})})},ICONS={home:House,check:SquareCheckBig,book:BookOpen,file:FileText,calendar:Calendar$1,note:NotebookPen,folder:Folder,user:User,settings:Settings,dollar:DollarSign},BottomBar=({overdueCount:e,onOpenFlyout:s})=>{const i=useLocation(),o=ROUTES.filter(a=>a.primary);return jsxRuntimeExports.jsxs("nav",{className:"bottom-toolbar grid grid-cols-5 md:hidden text-xs font-medium text-slate-500",children:[o.map(a=>{const c=ICONS[a.icon];return jsxRuntimeExports.jsxs(NavLink,{to:a.path,"aria-label":a.label,className:({isActive:d})=>`flex flex-col items-center gap-1 rounded-2xl px-2 py-2 transition-colors focus-visible:ring-offset-0 ${d?"bg-primary-50 text-primary-600":"text-slate-500 hover:bg-primary-50/70 hover:text-primary-600"}`,children:[jsxRuntimeExports.jsx(c,{size:18}),jsxRuntimeExports.jsxs("span",{className:`flex items-center gap-1 text-[11px] leading-tight ${i.pathname.startsWith(a.path)?"font-semibold":""}`,children:[a.label,a.path==="/tasks"&&e>0?jsxRuntimeExports.jsx("span",{className:"inline-flex h-4 min-w-[1rem] items-center justify-center rounded-full bg-rose-500 px-1 text-[0.625rem] font-semibold text-white",children:e}):null]})]},a.path)}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:s,"aria-label":"More",className:"flex flex-col items-center gap-1 rounded-2xl px-2 py-2 text-slate-500 transition-colors hover:bg-primary-50/70 hover:text-primary-600 focus-visible:ring-offset-0",children:[jsxRuntimeExports.jsx(Ellipsis,{size:18}),jsxRuntimeExports.jsx("span",{className:"text-[11px] font-semibold leading-tight",children:"More"})]})]})},Layout=()=>{const e=useNavigate(),s=useLocation(),{logout:i,mode:o,isAuthenticated:a}=useAuth(),{activeEstateId:c}=useEstate(),[d,g]=reactExports.useState(0),[h,_]=reactExports.useState(!1);reactExports.useEffect(()=>{if(o!=="supabase"||!a||typeof window>"u")return;let _e=!0;const tt=async()=>{if(_e)try{await syncWorkspaceFromCloud(c)}catch(at){console.error(at)}};tt();const rt=()=>{tt()},et=()=>{document.visibilityState==="visible"&&tt()};window.addEventListener("focus",rt),document.addEventListener("visibilitychange",et);const ut=window.setInterval(tt,6e4);return()=>{_e=!1,window.removeEventListener("focus",rt),document.removeEventListener("visibilitychange",et),window.clearInterval(ut)}},[c,o,a]),reactExports.useEffect(()=>{let _e=!0;const tt=liveQuery(()=>db.tasks.where("estateId").equals(c).toArray()).subscribe({next:rt=>{if(!_e)return;const et=new Date;et.setHours(0,0,0,0);const ut=rt.filter(at=>{if(at.status==="done")return!1;const nt=new Date(at.due_date);return Number.isNaN(nt.valueOf())?!1:nt<et}).length;g(ut)},error:rt=>{console.error(rt)}});return()=>{_e=!1,tt.unsubscribe()}},[c]);const j=()=>{(async()=>{try{await i()}catch(_e){console.error(_e)}finally{e("/login",{replace:!0})}})()};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(FlyoutMenu,{open:h,onClose:()=>_(!1),overdueCount:d,onLogout:j}),jsxRuntimeExports.jsx("header",{className:"sticky top-0 z-20 border-b border-slate-200/70 bg-white/80 backdrop-blur",children:jsxRuntimeExports.jsxs("div",{className:"mx-auto flex w-full max-w-6xl items-center justify-between px-4 py-3 md:px-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("span",{className:"rounded-full bg-primary-500/10 p-2 text-lg text-primary-600",children:"üèõÔ∏è"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-semibold uppercase tracking-[0.2em] text-primary-500",children:"Estate"}),jsxRuntimeExports.jsx("p",{className:"text-lg font-semibold text-slate-900",children:"Administration Workspace"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsxs("nav",{className:"hidden items-center gap-2 md:flex",children:[ROUTES.map(_e=>jsxRuntimeExports.jsx(NavLink,{to:_e.path,className:({isActive:tt})=>`rounded-full px-4 py-2 text-sm font-medium transition-colors focus-visible:ring-offset-0 ${tt?"bg-primary-50 text-primary-700 shadow-inner shadow-primary-200/40":"text-slate-600 hover:bg-primary-50/60 hover:text-primary-600"}`,children:jsxRuntimeExports.jsxs("span",{className:"flex items-center gap-2",children:[_e.label,_e.path==="/tasks"&&d>0?jsxRuntimeExports.jsx("span",{className:"inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-rose-500 px-1.5 text-xs font-semibold text-white",children:d}):null]})},_e.path)),jsxRuntimeExports.jsx("button",{type:"button",onClick:j,className:"rounded-full px-4 py-2 text-sm font-semibold text-slate-600 transition-colors hover:bg-rose-50 hover:text-rose-600 focus-visible:ring-offset-0",children:"Logout"})]}),jsxRuntimeExports.jsx("button",{type:"button","aria-label":"Menu",onClick:()=>_(!0),className:"rounded-full border border-slate-200 p-2 text-slate-600 transition-colors hover:border-slate-300 hover:text-slate-900",children:jsxRuntimeExports.jsx(Ellipsis,{size:22})})]})]})}),jsxRuntimeExports.jsx("main",{className:"main-shell",children:jsxRuntimeExports.jsx("div",{className:"mx-auto w-full max-w-6xl px-4 py-8 md:px-6 lg:py-12",children:jsxRuntimeExports.jsx("div",{className:"animate-fade-in",children:jsxRuntimeExports.jsx(Outlet,{})},s.pathname)})}),jsxRuntimeExports.jsx(BottomBar,{overdueCount:d,onOpenFlyout:()=>_(!0)})]})},RequireAuth=()=>{const{isAuthenticated:e,isReady:s}=useAuth();return s?e?jsxRuntimeExports.jsx(Outlet,{}):jsxRuntimeExports.jsx(Navigate,{to:"/login",replace:!0}):null},App=()=>jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/login",element:jsxRuntimeExports.jsx(Login,{})}),jsxRuntimeExports.jsx(Route,{element:jsxRuntimeExports.jsx(RequireAuth,{}),children:jsxRuntimeExports.jsxs(Route,{element:jsxRuntimeExports.jsx(Layout,{}),children:[jsxRuntimeExports.jsx(Route,{index:!0,element:jsxRuntimeExports.jsx(Navigate,{to:"/dashboard",replace:!0})}),jsxRuntimeExports.jsx(Route,{path:"/dashboard",element:jsxRuntimeExports.jsx(Dashboard,{})}),jsxRuntimeExports.jsxs(Route,{path:"/tasks",children:[jsxRuntimeExports.jsx(Route,{index:!0,element:jsxRuntimeExports.jsx(Tasks,{})}),jsxRuntimeExports.jsx(Route,{path:":taskId",element:jsxRuntimeExports.jsx(Tasks,{})})]}),jsxRuntimeExports.jsx(Route,{path:"/guidance",element:jsxRuntimeExports.jsx(Guidance,{})}),jsxRuntimeExports.jsx(Route,{path:"/documents",element:jsxRuntimeExports.jsx(Documents,{})}),jsxRuntimeExports.jsx(Route,{path:"/buyout",element:jsxRuntimeExports.jsx(Buyout,{})}),jsxRuntimeExports.jsx(Route,{path:"/calendar",element:jsxRuntimeExports.jsx(Calendar,{})}),jsxRuntimeExports.jsx(Route,{path:"/journal",element:jsxRuntimeExports.jsx(Journal,{})}),jsxRuntimeExports.jsx(Route,{path:"/profile",element:jsxRuntimeExports.jsx(Profile,{})}),jsxRuntimeExports.jsx(Route,{path:"/setup",element:jsxRuntimeExports.jsx(Setup,{})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(NotFound,{})})]})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(Navigate,{to:"/login",replace:!0})})]});class ErrorBoundary extends reactExports.Component{constructor(){super(...arguments);bn(this,"state",{error:null});bn(this,"reset",()=>{this.setState({error:null})})}static getDerivedStateFromError(i){return{error:i}}componentDidCatch(i,o){console.error("App crash",i,o)}render(){return this.state.error?this.props.fallback(this.state.error,this.reset):this.props.children??null}}const Crash=(e,s)=>{const i=()=>{try{window.localStorage.setItem("cloud:disabled","1")}catch(o){console.warn("Unable to persist safe mode flag",o)}window.location.replace("/estate/?safe=1")};return jsxRuntimeExports.jsxs("div",{style:{padding:"16px",fontFamily:'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif'},children:[jsxRuntimeExports.jsx("h2",{children:"Something went wrong"}),jsxRuntimeExports.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:String((e==null?void 0:e.message)??e)}),jsxRuntimeExports.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:i,children:"Disable Cloud and reload"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>s(),children:"Try again"})]})]})};client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(ErrorBoundary,{fallback:Crash,children:jsxRuntimeExports.jsx(BrowserRouter,{basename:"/estate",children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(EstateProvider,{children:jsxRuntimeExports.jsx(App,{})})})})})}));
